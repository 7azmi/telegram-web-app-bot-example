<!DOCTYPE html>
<html>
<head>
    <title>Telegram Web App Contact Request Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff); /* Use Web App theme colors */
            color: var(--tg-theme-text-color, #000000);
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            /* Use Web App theme colors for button */
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 5px;
        }
        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0); /* Use theme colors */
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            white-space: pre-wrap; /* Preserve formatting */
            word-wrap: break-word; /* Prevent overflow */
            border-radius: 5px;
        }
    </style>
</head>
<body>

<h1>Request Contact Info</h1>

<p>This demo requests your phone number using the Telegram Web App API.</p>

<button id="requestButton">Request My Phone Number</button>

<div id="result">Status: Loading Telegram Web App script...</div>

<!-- Include the Telegram Web App script -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
    const requestButton = document.getElementById('requestButton');
    const resultDiv = document.getElementById('result');

    // Function to display status messages
    function updateStatus(message) {
        resultDiv.innerText = 'Status: ' + message;
    }

    // Wait for the Telegram Web App script to load and initialize
    // The SDK attaches Telegram.WebApp to the window object
    window.addEventListener('load', () => {
        if (window.Telegram && window.Telegram.WebApp) {
            const WebApp = window.Telegram.WebApp;

            // Signal that the Web App is ready to the Telegram client
            WebApp.ready();

            // Apply theme parameters as CSS variables
            // The SDK does this automatically, but good to know
            // console.log('Theme Params:', WebApp.themeParams);

            updateStatus("Telegram Web App initialized. Version: " + WebApp.version + ". Platform: " + WebApp.platform + ".\nClick the button.");

            // Check if the required version for requestContact is supported (v6.9+)
            // The SDK code includes: if (!versionAtLeast('6.9')) { ... error ... }
            // So we should check this explicitly before trying to call the method.
            if (!WebApp.isVersionAtLeast('6.9')) {
                updateStatus("Telegram Web App version " + WebApp.version + " does not support requesting contact info (requires 6.9 or higher). Button disabled.");
                requestButton.disabled = true; // Disable the button if not supported
            } else {
                // Enable the button if the version is compatible
                requestButton.disabled = false;

                // Add click listener to the button
                requestButton.addEventListener('click', () => {
                    updateStatus("Requesting contact info...");
                    requestButton.disabled = true; // Disable button while request is pending

                    // Call the requestContact API
                    WebApp.requestContact((requestSent, eventData) => {
                        requestButton.disabled = false; // Re-enable button after response

                        console.log("requestContact response:", { requestSent, eventData });

                        if (requestSent) {
                            // The SDK handles the internal polling. If requestSent is true,
                            // it means the request was sent to the Telegram client.
                            // If the user grants access, the callback is re-triggered with
                            // the phone number in eventData.responseUnsafe.
                            // If the user denies after the popup, status will reflect that.

                            if (eventData && eventData.responseUnsafe && eventData.responseUnsafe.phone_number) {
                                updateStatus("Contact Granted! Phone Number: " + eventData.responseUnsafe.phone_number);
                            } else if (eventData && eventData.status) {
                                // Handle cases like 'cancelled' or 'denied' after the popup
                                updateStatus("Request Result: " + eventData.status);
                            } else {
                                updateStatus("Request Sent, but unknown response.");
                            }

                        } else {
                            // requestSent is false, meaning the initial call failed or was cancelled.
                            // This could happen if the user closes the Web App before responding,
                            // or if there's an internal error.
                            if (eventData && eventData.status) {
                                updateStatus("Request Failed or Cancelled: " + eventData.status);
                            } else {
                                updateStatus("Request Failed or Cancelled (Unknown reason).");
                            }
                        }
                    });
                });
            }


        } else {
            updateStatus("Telegram Web App script not loaded or not running in a Telegram client environment.");
            requestButton.disabled = true; // Disable button if SDK is not available
        }
    });


</script>

</body>
</html>